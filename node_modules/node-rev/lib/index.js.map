{"version":3,"sources":["../src/index.es6"],"names":["options","manifest","files","filesPath","outputDir","__dirname","outputDest","resolve","file","hash","writeManifest","ensureFileSync","writeFileSync","JSON","stringify","join","filesPathParts","split","forEach","filePathPart","concat","sync","baseDir","length","slice","parsedPath","parse","filename","base","dirParts","dir","fileDirParts","unshift","pop","fileDir","buffer","readFileSync","revdPath","console","warn"],"mappings":"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","file":"index.js","sourcesContent":["import revHash from'rev-hash'\nimport revPath from'rev-path'\nimport path from'path'\nimport fs from'fs-extra'\nimport glob from'glob'\nimport commondir from'commondir'\nimport assert from'assert'\n\nexport default function(options) {\n\n  const manifest = {}\n  //use assert to require filesPath, outputDir\n  assert(options.files, 'files property is required')\n  const filesPath = options.files\n  const outputDir = options.outputDir || __dirname\n  const outputDest = path.resolve(outputDir)\n  const file = options.file\n  const hash = options.hash || false\n\n  function writeManifest(manifest) {\n    if (file) {\n      fs.ensureFileSync(path.resolve(file))\n      fs.writeFileSync(path.resolve(file), JSON.stringify(manifest), 'utf8')\n    } else {\n      fs.writeFileSync(path.join(__dirname, 'assets.json'), JSON.stringify(manifest), 'utf8');\n    }\n  }\n\n  const filesPathParts = filesPath.split(',')\n  let files = []\n  filesPathParts.forEach(function(filePathPart) {\n    files = files.concat(files, glob.sync(path.resolve(filePathPart), {}))\n  })\n\n  let baseDir\n  if (files && files.length === 1) {\n    baseDir = files[0].split('/').slice(0,-1).join('/')\n  } else {\n    baseDir = commondir(files)\n  }\n  if (files && files.length) {\n    files.forEach(function(file) {\n      const parsedPath = path.parse(file)\n      const filename = parsedPath.base\n      const dirParts = parsedPath.dir.split('/')\n      let fileDirParts = []\n      while(dirParts.join('/') !== baseDir) {\n        fileDirParts.unshift(dirParts.pop())\n      }\n      let fileDir = fileDirParts.join('/')\n      const buffer = fs.readFileSync(file)\n      if (hash) {\n        const hash = revHash(buffer)\n        const revdPath = revPath(path.join(fileDir, filename), hash)\n        manifest[path.join(fileDir, filename)] = revdPath\n        fs.ensureFileSync(path.join(outputDest, revdPath))\n        fs.writeFileSync(path.join(outputDest, revdPath), buffer)\n      } else {\n        manifest[path.join(fileDir, filename)] = path.join(fileDir, filename)\n        fs.ensureFileSync(path.join(outputDest, path.join(fileDir, filename)))\n        fs.writeFileSync(path.join(outputDest, path.join(fileDir, filename)), buffer)\n      }\n    })\n    writeManifest(manifest)\n\n  } else {\n    console.warn(`No files found matching ${path.resolve(filesPath)}`)\n    writeManifest({})\n  }\n}\n"]}